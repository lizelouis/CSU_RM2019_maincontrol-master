#include "Lower machine.h"
//********************************???****************************************
/*
?????:
??   0xFF, 0xFA, 0xFD, 0xF6
??????     ???   ??   10    ??     0     ??    250
????(??)  ???uint16??
??
????    0x0A

??:   ????float SendFloat[3]?????
????      0xFF, 0xFA, 0xFD, 0xF6
??          0
????????     uint16 size =  sizeof(SendFloat)????size
??           ?????????
????      0x0A
*/

//////????



void uart_putbuff (USART_TypeDef* uartn, u8 *buff, u32 len)
{
    while(len--)
    {
        USART_SendData(uartn, *buff);
        buff++;
    }
}


u8 SendHead[4] = {0xFF, 0xFA, 0xFD, 0xF6};
//////?????
/////??????????????
/////??????6???,??????????????,6??????????????

void SendWaveData(USART_TypeDef* uartn, u8 * data, u16 size)
{
  u8 psize[2] = {0};
  if(size >= 256)
    psize[0] = size / 256;
  psize[1] = size - 256 * (u16)psize[0];
	
  uart_putbuff(uartn, SendHead, 4);//????
  USART_SendData(uartn, 0);//??????????
  uart_putbuff(uartn, psize, sizeof(psize));
  uart_putbuff(uartn, data, size);
  USART_SendData(uartn, 0x0A);  ////??????
}

/////??????
////???????????????,??????????????
void SendPicData(USART_TypeDef* uartn, u8 * data, u16 size)
{
  u8 psize[2] = {0};
  if(size >= 256)//??????,???256?,????????psize[0]??,??????psize[1]??
    psize[0] = size / 256;
  psize[1] = size - 256 * (u16)psize[0];
  
  uart_putbuff(uartn, SendHead, 4);
  USART_SendData(uartn, 250);
  uart_putbuff(uartn, psize, sizeof(psize));
  uart_putbuff(uartn, data, size);
 USART_SendData(uartn, 0x0A);  ////??????
}

//******************************************************************************


//********************************???****************************************
/*
                        ??
????????:[CMD] [~CMD][…??…][~ CMD] [CMD]
?????? CMD ? 1,???????????:[0x01] [0xFE][…??…][0xFE] [0x01]
[…??…] ??????,?????????,????????????????,
[…??…]??????,???????????????,??????,??????
??
?????????????????????????,??????????,?
????????
????????,?????:0x01,0xFE,????????,??????:
0xFE,0x01 ?????????

                        ???
????????:[CMD] [~CMD][…??…][~ CMD] [CMD]
?????? CMD ? 3,?????????????:[0x03] [0xFC][…??…][0xFC]
[0x03]
[…??…] ???????????????????,?????????????
5 ???,uint8_t ??(unsigned char),?????? 5 ???,??????? 1 ??
? 5 ??????
??????????,?????:0x03,0xFC,???????????,???
???:0xFC,0x03 ????????

*/

//////????
u8 SendHead_sw_imag[4] = {0x01, 0xFE};
u8 Sendlast_sw_imag[4] = {0xFE, 0x01};

u8 SendHead_sw_wave[4] = {0x03, 0xFC};
u8 Sendlast_sw_wave[4] = {0xFC, 0x03};
//////?????
/////??????????????
/////??????6???,??????????????,6??????????????

void SendWaveData_sw(USART_TypeDef* uartn, u8 * data, u16 size)
{ 
  uart_putbuff(uartn, SendHead_sw_wave, 2);//????
  uart_putbuff(uartn, data, size);
  uart_putbuff(uartn, Sendlast_sw_wave, 2);//????
}

void SendimagData_sw(USART_TypeDef* uartn, u8 * data, u16 size)
{ 
  uart_putbuff(uartn, SendHead_sw_imag, 2);//????
  uart_putbuff(uartn, data, size);
  uart_putbuff(uartn, Sendlast_sw_imag, 2);//????
}
//******************************************************************************
